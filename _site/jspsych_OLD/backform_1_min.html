<!doctype html>
<html>
  <head>
    <title>My experiment</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="jspsych-5.0.3/jspsych.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-text.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-html.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-single-stim.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-survey-text.js"></script>
    <link href="jspsych-5.0.3/css/jspsych.css" rel="stylesheet" type="text/css"></link>
<style>
/* p { font-size: 36px; text-align: center; line-height: 1.8;} */
</style>
  </head>
  <body>
  </body>
  <script>

/*define consent block*/

var check_consent = function(elem) {
  if ($('#consent_checkbox').is(':checked')) {
    return true;
  }
  else {
    alert("If you wish to participate, you must check the box next to the statement 'I agree to participate in this study.'");
    return false;
  }
  return false;
};

// currently no consent_block in trial timeline
// declare the block.
var consent_block = {
  type:'html',
  url: "ceg_ver_consent.html",
  cont_btn: "start",
  check_fn: check_consent
};

  /* define welcome message block */
  var welcome_block = {
    type: "text",
    text: "Welcome to the experiment. Press any key to begin."
  };

  /* define instructions block */
  var instructions_block = {
    type: "text",
	text: "<p>In this experiment, you will read a sentence" +
      ", and then fill in the missing word in the next sentence.</p>" +
      "<p>Press any key to begin.</p>"
};

  /* define survey block */

var survey_trial = {
  type: 'survey-text',
  questions: ["How old are you?", "Where were you born?", "What age did you begin learning Welsh?", "How many years of school in Welsh have you had? (i.e. Welsh-medium education)"],
  rows: [1,1,1,1],
  columns: [50,100,50,50]
};

  /* define test block */

var backform_proc = {
	timeline: [
		{
			type: 'single-stim',
			stimulus: jsPsych.timelineVariable('p'),
			choices: jsPsych.NO_KEYS,
			is_html: true
			//data: jsPsych.timelineVariable('type'),
			//timing_response: -1
		},
		{
			type: 'survey-text',
			questions: jsPsych.timelineVariable('question'),
			columns: [50],
			rows: [1]
		}
	],
	timeline_variables: [
		{ p: 'Dyma ei gi.', question: 'Mae ______ gyda fo.', type: 'unambig' },
		{ p: 'Dyma ei law.', question: 'Mae ______ gyda fo.', type: 'ambig' },
		{ p: 'Dyma ei lyb.', question: 'Mae ______ gyda fo.', type: 'nonce' },
		{ p: 'Dyma ei gath.', question: 'Mae ______ gyda fo.', type: 'unambig' },
		{ p: 'Dyma ei lo.', question: 'Mae ______ gyda fo.', type: 'ambig' },
		{ p: 'Dyma ei wb.', question: 'Mae ______ gyda fo.', type: 'nonce' }
	],
	randomize_order: true
}




  var debrief_block = {
    type: "text",
    text: "Thank you!"
  };

function saveData(filename, filedata){
   $.ajax({
      type:'post',
      cache: false,
      url: 'saveData.php', // this is the path to the above PHP script
      data: {filename: filename, filedata: filedata}
   });
}

  /* generate a random subject ID */
var subject_id = Math.floor(Math.random()*100000);

  /* record the condition assignment in the jsPsych data */
  /* this adds a property called 'subject' to every trial */
jsPsych.data.addProperties({
  subject: subject_id
}); 

  /* create experiment timeline array */
  var timeline = [];
  timeline.push(welcome_block);
  timeline.push(instructions_block);
  timeline.push(survey_trial);
  timeline.push(backform_proc);
  timeline.push(debrief_block);

  /* start the experiment */
  jsPsych.init({
    timeline: timeline,
on_finish: function(data){
            saveData('subject-'+subject_id+'.csv', jsPsych.data.dataAsCSV());
            }
});
</script>
</html>