<!doctype html>
<html>
  <head>
    <title>Perception</title>

    <script src="jspsych-5.0.3/jspsych.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-text.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-html.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-survey-text.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-survey-likert.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-single-stim.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-button-response.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-single-audio.js" type="text/javascript"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-call-function.js"></script>
    <link href="jspsych-5.0.3/css/jspsych.css" rel="stylesheet" type="text/css"></link>

  </head>
  <body>
  </body>
  <script>

  /* define welcome message block */
  var welcome_block = {
    type: "text",
    text: "<p>Welcome to the experiment!</p>" +
		"<p>First you will answer some basic questions" +
		" about your language background with Welsh and English.</p>" +
		"Press any key to begin."
  };

/*define consent block*/

var check_consent = function(elem) {
  if ($('#consent_checkbox').is(':checked')) {
    return true;
  }
  else {
    alert("If you wish to participate, you must check the box next to the statement 'I agree to participate in this study.'");
    return false;
  }
  return false;
};

// declare the consent block
var consent_block = {
  type:'html',
  url: "consent_3.html",
  cont_btn: "start",
  check_fn: check_consent
};

//define initials block //
var initials_block = {
  type: 'survey-text',
  questions: ["Please type your initials in the box."],
  choices: ['enter']
};

// typed responses
var first_page = {
  type: 'survey-text',
  questions: ["How old are you?", "What gender do you identify with?", "Current place of residence (City, Country)", "What is your highest level of formal education?", "What hand do you write with?", "At what age did you start learning Welsh?", "At what age did you start learning English?"],
};

  /* define PICTURE instructions block */
  var instructions_pic_block = {
    type: "text",
text: "<p>Thank you for completing the background survey.</p>" +
	"<p>In the first part of this experiment, you will hear a vowel sound and see two pictures on the screen." +
        "</p><p>If the vowel you hear belongs in the Welsh word for the <strong>LEFT</strong> picture, " +
        "press the LEFT ARROW on the keyboard.</p>" +
        "<p>If the vowel you hear belongs in the Welsh word for the <strong>RIGHT</strong> picture, press the RIGHT ARROW on the keyboard. First there will be a short practice period.</p>" +
        "<p>Please wear headphones to complete this task.</p>" +
        "<p>Press any key to begin.</p>",
    timing_post_trial: 500
  };

  /* define WORD instructions block */
  var instructions_word_block = {
    type: "text",
text: "<p>Great work! In the next part, you will hear a vowel sound and see two Welsh words on the screen." +
        "</p><p>If the vowel you hear belongs to the word on the <strong>LEFT</strong>, " +
        "press the LEFT ARROW on the keyboard.</p>" +
        "<p>If the vowel you hear belongs to the word on the <strong>RIGHT</strong>, press the RIGHT ARROW on the keyboard. First there will be a short practice period.</p>" +
        "<p>Please wear headphones to complete this task.</p>" +
        "<p>Press any key to begin.</p>",
    timing_post_trial: 500
  };

  /* define PIC-PRACTICE instructions block */
  var instructions_pic_prac_block = {
    type: "text",
text: "<p>Before we get started, can you help us name these pictures?</p><p>Just click the button next to the choice that shows the correct <strong>first</strong> and <strong>last</strong> letters of the Welsh word that best describes the picture.</p>" +
        "<p>For example, if you saw this picture:</p>" +
        "<img src='img/cath.jpg' />" +
        "<p>You would click the button that showed C__TH.</p>" +
        "<p>Press ENTER to begin.</p>",
    timing_post_trial: 500
  };

  var pic_naming_stimuli = [
{
stimulus: 'img/lon.jpg',
choices: ['S__A', 'N__B', 'L__N', 'G__FF'],
data: { response: 'L__N' } },
{
stimulus: 'img/dyn.jpg',
choices: ['D__N', 'P__N', 'FF__L', 'M__T'],
data: { response: 'D__N' } },
{
stimulus: 'img/tim.jpg',
choices: ['TH__W', 'G__FF', 'C__N', 'T__M'],
data: { response: 'T__M' } },
{
stimulus: 'img/bryn.jpg',
choices: ['T__W', 'B__N', 'C__M', 'RH__DD'],
data: { response: 'B__N' } },
{
stimulus: 'img/ton.jpg',
choices: ['D__R', 'T__N', 'W__T', 'M__R'],
data: { response: 'T__N' } }
  ];

  /* define PICTURE NAMING block */

var pic_naming_block = {
    type: 'button-response',
    prompt: "<p class='center-content'>What letters does this word begin and end with in Welsh?</p>",
    button_html: "<a class='jspsych-btn'>%choice%</a>",
    response_ends_trial: true,
    timeline: pic_naming_stimuli
  };

  /* define PICTURE block */

  var pic_stimuli = [
{
stimulus: "sounds/y_1_1.wav",
prompt: ['<img src="img/dyn-bryn.jpg" />'],
data: { response: 'y_1_1.wav' } },
{
stimulus: "sounds/y_1_9.wav",
prompt: ['<img src="img/dyn-bryn.jpg" />'],
data: { response: 'y_1_9.wav' } },
{
stimulus: "sounds/y_9_9.wav",
prompt: ['<img src="img/dyn-bryn.jpg" />'],
data: { response: 'y_9_9.wav' } },
{
stimulus: "sounds/y_9_1.wav",
prompt: ['<img src="img/dyn-bryn.jpg" />'],
data: { response: 'y_9_1.wav' } }
  ];

  var word_stimuli = [
{
stimulus: "sounds/y_1_1.wav",
prompt: ['<img src="img/tyn_orth_comp.jpg" />'],
data: { response: 'y_1_1.wav' } },
{
stimulus: "sounds/y_1_9.wav",
prompt: ['<img src="img/tyn_orth_comp.jpg" />'],
data: { response: 'y_1_9.wav' } },
{
stimulus: "sounds/y_9_9.wav",
prompt: ['<img src="img/tyn_orth_comp.jpg" />'],
data: { response: 'y_9_9.wav' } },
{
stimulus: "sounds/y_9_1.wav",
prompt: ['<img src="img/tyn_orth_comp.jpg" />'],
data: { response: 'y_9_1.wav' } }
  ];

var pic_trials = jsPsych.randomization.repeat(pic_stimuli, 1);

var word_trials = jsPsych.randomization.repeat(word_stimuli, 1);

//var trials1 = [];
//var trials2 = [];

//var condition_assignment = jsPsych.randomization.sample(['pic', 'word'],1)[0];

var pic_block = {
	type: "single-audio",
	choices: [37, 39],
	timing_response: -1,
	timing_post_trial: 1500,
	response_ends_trial: true,
	on_finish: function(data){
		var correct = false;
			if(data.response == 'long' && data.key_press == 37 && data.rt > -1){
				correct = true;
		} else if(data.response == 'short' && data.key_press == 39 && data.rt > -1){
			correct = true;
		}
      jsPsych.data.addDataToLastTrial({correct: correct});
    },
    timeline: pic_trials
  };

var word_block = {
	type: "single-audio",
	choices: [37, 39],
	timing_response: -1,
	timing_post_trial: 1500,
	response_ends_trial: true,
	on_finish: function(data){
		var correct = false;
			if(data.response == 'long' && data.key_press == 37 && data.rt > -1){
				correct = true;
		} else if(data.response == 'short' && data.key_press == 39 && data.rt > -1){
			correct = true;
		}
      jsPsych.data.addDataToLastTrial({correct: correct});
    },
    timeline: word_trials
  };

function saveData(filename, filedata){
   $.ajax({
      type:'post',
      cache: false,
      url: 'saveData.php', // this is the path to the above PHP script
      data: {filename: filename, filedata: filedata}
   });
}

  /* generate a random subject ID */
var subject_id = Math.floor(Math.random()*100000);

  /* record the condition assignment in the jsPsych data */
  /* this adds a property called 'subject' to every trial */
  jsPsych.data.addProperties({
  subject: subject_id,
  condition: condition_assignment
}); 

var save_data = {
	type: 'call-function',
	func: function(data){
           saveData('ident_pic-'+subject_id+'.csv', jsPsych.data.dataAsCSV());
            }
	};

var debrief_block = {
	type: 'html',
	url: 'thank_you1.html',
	on_finish: function() {exit()}
};

var pic1st = [instructions_pic_block, pic_block, instructions_word_block, word_block]
var word1st = [instructions_word_block, word_block, instructions_pic_block, pic_block]

// var chooseTimeline = jsPsych.randomization.repeat(twoTimelines, 1);
var condition_assignment = jsPsych.randomization.sample([pic1st, word1st],1)[0];


  /* create PIC timeline array */

  var timeline = [];
 // timeline.push(consent_block);
 timeline.push(initials_block);
 // timeline.push(welcome_block);
 // timeline.push(first_page);
 // timeline.push(instructions_pic_prac_block);
 // timeline.push(condition_assignment);
 // timeline.push(save_data);
 // timeline.push(debrief_block);

  /* start the experiment */
  jsPsych.init({
    timeline: timeline,
    //show_progress_bar: true
});

</script>
</html>